<div class="container">
  <div class="row">
    <div class="col-12 main">
      <h1>Note</h1>
      <%= flash[:notice] %>

      <div class="note-contents note-contents2"><!--ルーズリーフの設定-->

        <!--ユーザー情報-->
        <%= link_to user_path(@user.id) do %>
          <%= render '/layouts/user_info', user: @user %>
        <% end %>

        <!--投稿内容-->
        <%= render '/layouts/note_contents', note: @note %>

        <!--いいねボタン-->
        <p><%= render '/public/favorites/favorites_btn', note: @note %>
          <span><i class="far fa-comment"></i><%= @note.note_comments.count %></span><!--ｺﾒﾝﾄ件数-->
        </p>
      </div>
      
      <p>
      <% if @note.user.id == current_user.id %><!--ログイン中ユーザーならeditとdestroyﾘﾝｸ-->
        <%= link_to "編集", edit_note_path(@note.id) %>
        <%= link_to "削除", note_path(@note.id), method: :delete, data: {confirm: 'このノートを消しますか？'} %>
      <% end %>
      </p>
      <!--コメント欄-->
      <div class="comment">
        <p>コメント</p>
        <% @note.note_comments.each do |note_comment| %>
        <div class="comments">
          <%= link_to (user_path(@user.id)) do %>
            <%= image_tag note_comment.user.get_image, class: "rounded-circle" %>
            <%= note_comment.user.name %>
          <% end %>

          <span><%= note_comment.created_at.strftime('%Y/%m/%d') %></span>
          <p><%= safe_join(note_comment.comment.split("\n"),tag(:br)) %></p>
          <% if note_comment.user == current_user %>
            <%= link_to "削除", note_note_comment_path(note_comment.note, note_comment.id), method: :delete, data: {confirm: 'このコメントを消しますか？'} %>
          <% end %>
        <% end %>
        </div>
      </div>
      <div class="comment col-12">
        <%= form_with model: [@note, @note_comment] do |f| %>
          <%= f.text_area :comment, rows: '4', placeholder: "質問に対する回答＆応援や励ましのコメントしてみましょう！", class: 'form-control mb-4' %>
          <%= f.submit "✍",class: 'btn btn-outline-secondary'  %>
        <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

